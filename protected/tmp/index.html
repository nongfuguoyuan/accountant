<!DOCTYPE html>
<!--[if IE 9]>         <html class="ie9 no-focus"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-focus"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>米蝶财务管理系统</title>
        <meta name="description" content="米蝶财务管理系统，最了解财务公司的财务系统">
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0">
        <link rel="shortcut icon" href="<?php echo $img;?>favicons/favicon.png">
        <link rel="stylesheet" href="<?php echo $js; ?>plugins/slick/slick.min.css">
        <link rel="stylesheet" href="<?php echo $js; ?>plugins/slick/slick-theme.min.css">
        <link rel="stylesheet" id="css-main" href="<?php echo $css; ?>oneui.css">
        <script>
            _permission = eval('<?php echo json_encode($permission);?>');
            _host = "<?php echo $host;?>";
            _static = "<?php echo $static; ?>";
            _config = {"name":"<?php echo $name;?>","level":"<?php echo $level;?>",'tag':"<?php echo $tag;?>","r_name":"<?php echo $r_name;?>","employee_id":"<?php echo $employee_id;?>",'error_code':eval('(<?php echo json_encode($error_code); ?>)')};
        </script>
    </head>
    <body>
        <!-- Page Container -->
        <!--
            Available Classes:

            'sidebar-l'                  Left Sidebar and right Side Overlay
            'sidebar-r'                  Right Sidebar and left Side Overlay
            'sidebar-mini'               Mini hoverable Sidebar (> 991px)
            'sidebar-o'                  Visible Sidebar by default (> 991px)
            'sidebar-o-xs'               Visible Sidebar by default (< 992px)

            'side-overlay-hover'         Hoverable Side Overlay (> 991px)
            'side-overlay-o'             Visible Side Overlay by default (> 991px)

            'side-scroll'                Enables custom scrolling on Sidebar and Side Overlay instead of native scrolling (> 991px)

            'header-navbar-fixed'        Enables fixed header
        -->
        <div id="page-container" class="sidebar-l sidebar-o side-scroll header-navbar-fixed">
            <!-- <aside id="side-overlay">
                <div id="side-overlay-scroll">
                    <div class="side-header side-content">
                        <button id="close-right" class="btn btn-default pull-right" type="button" data-toggle="layout" data-action="side_overlay_close">
                            <i class="fa fa-times"></i>
                        </button>
                        <span>
                            <img class="img-avatar img-avatar32" src="assets/img/avatars/avatar10.jpg" alt="">
                            <span class="font-w600 push-10-l">详细信息</span>
                        </span>
                    </div>
                    <div class="side-content remove-padding-t">
                        <div class="block pull-r-l">
                            <div class="block-header bg-gray-lighter">
                                <h3 class="block-title">Recent Activity</h3>
                            </div>
                            <div class="block-content">
                                <ul class="list list-activity">
                                    <li>
                                    
                                        <i class="si si-wallet text-success"></i>
                                        <div class="font-w600">New sale ($15)</div>
                                        <div><a href="javascript:void(0)">Admin Template</a></div>
                                        <div><small class="text-muted">3 min ago</small></div>
                                    </li>
                                </ul>
                                <div class="text-center">
                                    <small><a href="javascript:void(0)">Load More..</a></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside> -->
            <!-- Sidebar -->
            <nav id="sidebar">
                <!-- Sidebar Scroll Container -->
                <div id="sidebar-scroll">
                    <!-- Sidebar Content -->
                    <!-- Adding .sidebar-mini-hide to an element will hide it when the sidebar is in mini mode -->
                    <div class="sidebar-content">
                        <!-- Side Header -->
                        <div class="side-header side-content bg-white-op">
                            <!-- Layout API, functionality initialized in App() -> uiLayoutApi() -->
                            <button class="btn btn-link text-gray pull-right hidden-md hidden-lg" type="button" data-toggle="layout" data-action="sidebar_close">
                                <i class="fa fa-times"></i>
                            </button>
                            <!-- Themes functionality initialized in App() -> uiHandleTheme() -->
                            <!-- <div class="btn-group pull-right">
                                <button class="btn btn-link text-gray dropdown-toggle" data-toggle="dropdown" type="button">
                                    <i class="si si-drop"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right font-s13 sidebar-mini-hide">
                                    <li>
                                        <a data-toggle="theme" data-theme="default" tabindex="-1" href="javascript:void(0)">
                                            <i class="fa fa-circle text-default pull-right"></i> <span class="font-w600">Default</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="theme" data-theme="assets/css/themes/amethyst.min.css" tabindex="-1" href="javascript:void(0)">
                                            <i class="fa fa-circle text-amethyst pull-right"></i> <span class="font-w600">Amethyst</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="theme" data-theme="assets/css/themes/city.min.css" tabindex="-1" href="javascript:void(0)">
                                            <i class="fa fa-circle text-city pull-right"></i> <span class="font-w600">City</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="theme" data-theme="assets/css/themes/flat.min.css" tabindex="-1" href="javascript:void(0)">
                                            <i class="fa fa-circle text-flat pull-right"></i> <span class="font-w600">Flat</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="theme" data-theme="assets/css/themes/modern.min.css" tabindex="-1" href="javascript:void(0)">
                                            <i class="fa fa-circle text-modern pull-right"></i> <span class="font-w600">Modern</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a data-toggle="theme" data-theme="assets/css/themes/smooth.min.css" tabindex="-1" href="javascript:void(0)">
                                            <i class="fa fa-circle text-smooth pull-right"></i> <span class="font-w600">Smooth</span>
                                        </a>
                                    </li>
                                </ul>
                            </div> -->
                            <a class="h5 text-white" href="<?php echo $host;?>index">
                                <!-- <i class="fa fa-circle-o-notch text-primary"></i>  -->
                                <i class="icon iconfont text-primary">&#xe600;</i>
                                <span class="h4 font-w600 sidebar-mini-hide">me</span>
                            </a>
                        </div>
                        <!-- END Side Header -->

                        <!-- Side Content -->
                        <div class="side-content">
                            <ul class="nav-main" id="me-navigation">
                                <li>
                                    <a class="active" href="<?php echo $host;?>index"><i class="si si-speedometer"></i><span class="sidebar-mini-hide">管理面板</span></a>
                                </li>
                                <li data-permission="guest/find" class="nav-main-heading"><span class="sidebar-mini-hide">CRM</span></li>
                                <li data-permission="guest/find">
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="si si-grid"></i><span class="sidebar-mini-hide">管理客户</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/users">所有客户</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-main-heading"><span class="sidebar-mini-hide">任务</span></li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="fa fa-briefcase"></i><span class="sidebar-mini-hide">工商</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/business">工商用户</a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="si si-magic-wand"></i><span class="sidebar-mini-hide">代理记账</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/accounting">代理记账用户</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-main-heading"><span class="sidebar-mini-hide">财务</span></li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="fa fa-money"></i><span class="sidebar-mini-hide">财务报表</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/tax">用户财务报表</a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="si si-wallet"></i><span class="sidebar-mini-hide">缴费记录</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/pay_record">所有客户</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-main-heading"><span class="sidebar-mini-hide">TODO</span></li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="fa fa-calendar"></i><span class="sidebar-mini-hide">TODOS</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/todo">所有任务</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-main-heading"><span class="sidebar-mini-hide">通讯录</span></li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="fa fa-users"></i><span class="sidebar-mini-hide">部门</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/department">所有部门</a>
                                        </li>
                                    </ul>
                                </li>
                                <li data-permission="roles">
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="#/roles"><i class="fa-user-secret fa"></i><span class="sidebar-mini-hide">角色</span></a>
                                </li>
                                <li class="nav-main-heading"><span class="sidebar-mini-hide">系统</span></li>
                                <li data-permission="processgroup">
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="fa fa-windows"></i><span class="sidebar-mini-hide">系统设置</span></a>
                                    <ul>
                                        <!-- <li>
                                            <a href="#/process_group">流程组</a>
                                        </li> -->
                                        <li data-permission="process/delete">
                                            <a href="#/process">流程</a>
                                        </li>
                                        <li data-permission="rescource">
                                            <a href="#/resource">来源</a>
                                        </li>
                                        <li data-permission="taxtype">
                                            <a href="#/tax_type">税务类型</a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a class="nav-submenu" data-toggle="nav-submenu" href="javascript:;"><i class="fa fa-cog"></i><span class="sidebar-mini-hide">账户</span></a>
                                    <ul>
                                        <li>
                                            <a href="#/account">修改密码</a>
                                        </li>
                                        <li>
                                            <a onclick="gologout()">注销</a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <!-- END Side Content -->
                    </div>
                    <!-- Sidebar Content -->
                </div>
                <!-- END Sidebar Scroll Container -->
            </nav>
            <!-- END Sidebar -->
            <!-- Header -->
            <header id="header-navbar" class="content-mini content-mini-full">
                <!-- Header Navigation Right -->
                <ul class="nav-header pull-right">
                    <li>
                        <div class="btn-group">
                            <button class="btn btn-default btn-image dropdown-toggle" data-toggle="dropdown" type="button">
                                <img src="<?php echo $img;?>avatars/avatar10.jpg" alt="Avatar">
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li>
                                    <a tabindex="-1" onclick="gologout()">
                                        <i class="si si-logout pull-right"></i>注销
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <!-- Layout API, functionality initialized in App() -> uiLayoutApi() -->
                        <!-- <button class="btn btn-default" data-toggle="layout" data-action="side_overlay_toggle" type="button">
                            <i class="fa fa-tasks"></i>
                        </button> -->
                    </li>
                </ul>
                <!-- END Header Navigation Right -->

                <!-- Header Navigation Left -->
                <ul class="nav-header pull-left">
                    <li class="hidden-md hidden-lg">
                        <!-- Layout API, functionality initialized in App() -> uiLayoutApi() -->
                        <button class="btn btn-default" data-toggle="layout" data-action="sidebar_toggle" type="button">
                            <i class="fa fa-navicon"></i>
                        </button>
                    </li>
                    <li class="hidden-xs hidden-sm">
                        <!-- Layout API, functionality initialized in App() -> uiLayoutApi() -->
                        <button class="btn btn-default" data-toggle="layout" data-action="sidebar_mini_toggle" type="button">
                            <i class="fa fa-ellipsis-v"></i>
                        </button>
                    </li>
                    <!-- <li>
                        <button class="btn btn-default pull-right" data-toggle="modal" data-target="#apps-modal" type="button">
                            <i class="si si-grid"></i>
                        </button>
                    </li> -->
                    <li class="visible-xs">
                        <!-- Toggle class helper (for .js-header-search below), functionality initialized in App() -> uiToggleClass() -->
                        <button class="btn btn-default" data-toggle="class-toggle" data-target=".js-header-search" data-class="header-search-xs-visible" type="button">
                            <i class="fa fa-search"></i>
                        </button>
                    </li>
                    <!-- <li class="js-header-search header-search">
                        <form class="form-horizontal" action="base_pages_search.html" method="post">
                            <div class="form-material form-material-primary input-group remove-margin-t remove-margin-b">
                                <input onkeyup="overallSearch(this,event)" class="form-control" type="text" id="base-material-text" name="base-material-text" placeholder="<?php echo $name.'->'.$r_name;?>">
                                <span class="input-group-addon"><i class="si si-magnifier"></i></span>
                                <div id="overall-search">
                                </div>
                            </div>
                        </form>
                    </li> -->
                    <li>
                        <button class="btn btn-minw btn-default" type="button" disabled="">
                            <small id="parent-nav">首页</small>    
                            <small id="sub-nav"></small>
                        </button>
                    </li>
                </ul>
                <!-- END Header Navigation Left -->
            </header>
            <!-- END Header -->

            <!-- Main Container -->
            <div id="main-container" ng-app="myapp">
                <div class="content">
                    <div ng-view></div>
                </div>
            </div>
            <!-- END Main Container -->
        </div>
            <!-- Footer -->
            <footer id="page-footer" class="content-mini content-mini-full font-s12 bg-gray-lighter clearfix">
                <div class="pull-right">
                    <!-- Dev<i class="fa fa-heart text-city"></i> by <a class="font-w600" href="http://mecaiwu.com" target="_blank">mecaiwu</a> -->
                    <span class="badge badge-info"><?php echo $name.'->'.$r_name;?></span>
                </div>
            </footer>
            <!-- END Footer -->
        </div>
        <!-- END Page Container -->

        <!-- Apps Modal -->
        <!-- Opens from the button in the header -->
        <div class="modal fade" id="apps-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-sm modal-dialog modal-dialog-top">
                <div class="modal-content">
                    <!-- Apps Block -->
                    <div class="block block-themed block-transparent">
                        <div class="block-header bg-primary-dark">
                            <ul class="block-options">
                                <li>
                                    <button data-dismiss="modal" type="button"><i class="si si-close"></i></button>
                                </li>
                            </ul>
                            <h3 class="block-title">Apps</h3>
                        </div>
                        <div class="block-content">
                            <div class="row text-center">
                                <div class="col-xs-6">
                                    <a class="block block-rounded" href="index.html">
                                        <div class="block-content text-white bg-default">
                                            <i class="si si-speedometer fa-2x"></i>
                                            <div class="font-w600 push-15-t push-15">Backend</div>
                                        </div>
                                    </a>
                                </div>
                                <div class="col-xs-6">
                                    <a class="block block-rounded" href="frontend_home.html">
                                        <div class="block-content text-white bg-modern">
                                            <i class="si si-rocket fa-2x"></i>
                                            <div class="font-w600 push-15-t push-15">Frontend</div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END Apps Block -->
                </div>
            </div>
        </div>
        <!-- END Apps Modal -->
        <a id="call-base-info" data-toggle="modal" data-target="#guest-base-info">ha</a>
        <div ng-app="base_info" class="modal in" id="guest-base-info" tabindex="-1" role="dialog" aria-hidden="false" style="display: none;">
            <div class="modal-dialog modal-xm">
                <div class="modal-content">
                    <div class="block block-themed block-transparent remove-margin-b">
                        <div class="block-header bg-primary-dark">
                            <ul class="block-options">
                                <li>
                                    <button data-dismiss="modal" type="button"><i class="si si-close"></i></button>
                                </li>
                            </ul>
                            <h3 class="block-title">基本信息</h3>
                        </div>
                        <div class="block-content push-20">
                            
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-default" type="button" data-dismiss="modal"><i class="fa fa-close"></i></button>
                        <!-- <button ng-click="editOne($event.target)" class="btn btn-sm btn-primary" type="button">更新</button> -->
                    </div>
                </div>
            </div>
        </div>
        <!-- OneUI Core JS: jQuery, Bootstrap, slimScroll, scrollLock, Appear, CountTo, Placeholder, Cookie and App.js -->
        <script src="<?php echo $js;?>core/jquery.min.js"></script>
        <script src="<?php echo $js;?>core/bootstrap.min.js"></script>
        <script src="<?php echo $js;?>core/jquery.slimscroll.min.js"></script>
        <script src="<?php echo $js;?>core/jquery.scrollLock.min.js"></script>
        <script src="<?php echo $js;?>core/jquery.appear.min.js"></script>
        <script src="<?php echo $js;?>core/jquery.countTo.min.js"></script>
        <script src="<?php echo $js;?>core/jquery.placeholder.min.js"></script>
        <script src="<?php echo $js;?>core/js.cookie.min.js"></script>
        <script src="<?php echo $js;?>/app.js"></script>
        <script src="<?php echo $js;?>layer/layer.js"></script>
        <!-- Page Plugins -->
        <script src="<?php echo $js;?>plugins/slick/slick.min.js"></script>
        <script src="<?php echo $js;?>plugins/chartjs/Chart.min.js"></script>

        <!-- Page JS Code -->
        <!-- // <script src="assets/js/pages/base_pages_dashboard.js"></script> -->
        <!-- // <script type="text/javascript" src='http://libs.useso.com/js/angular.js/1.3.0-beta.13/angular.min.js'></script> -->
        <!-- // <script type="text/javascript" src='http://libs.useso.com/js/angular.js/1.3.0-beta.13/angular-route.min.js'></script> -->
        <!-- // <script src="http://libs.useso.com/js/angular.js/1.3.0-beta.9/angular-resource.min.js"></script> -->
        <script src="<?php echo $js;?>angular1.3.js"></script>
        <script src="<?php echo $js;?>angular-route.js"></script>
        <script src='<?php echo $js;?>controller.js'></script>
        <script src='<?php echo $js;?>validate.js'></script>
        <script src='<?php echo $js;?>laydate/laydate.js'></script>
        <script>

            $(function () {
                // Init page helpers (Slick Slider plugin)
                App.initHelpers('slick');
                initPermission(_permission);
            });
            
            function buildLi(arr,fn){
                if(typeof arr != 'undefined' && arr.length > 0){
                    var ul = $("<ul>");
                    arr.forEach(function(ele,index){
                        var li = $('<li>').text(ele.company);
                        (function(li,ele){
                            li.bind('click',function(){
                                if(typeof fn == 'function') fn(ele);
                            });
                        })(li,ele);
                        ul.append(li);
                    });
                    return ul;
                }else{
                    return false;
                }
            }


            function overallSearch(othis,e){

                var ele = $('#overall-search'),
                    value = othis.value.trim(),
                    key = e.keyCode,
                    sureme = function(obj){
                        othis.value = obj.company
                        //find
                        ele.empty();
                        $("#call-base-info").trigger('click');
                    };

                // if(key == '40'){//down
                //     if(index < len -1){
                //         lis.removeClass('active');
                //         lis.eq(index+1).addClass('active');
                //     }
                // }
                // if(key == '38'){//up
                //     if(index > 0){
                //         lis.removeClass('active');
                //         lis.eq(index-1).addClass('active');
                //     }
                // }
                // if(key == '13'){//enter
                //     var value = $(ele).val();
                //     if(value){
                //         $(active).trigger('click'); 
                //     }else{
                //         $route.reload();
                //     }
                // }


                if(/^1[35789]\d*$/.test(value)){
                    //phone
                    $.post(_host+'accountant/guest/searchByPhone',{'phone':value},function(r){
                        if(r){
                            var ul = buildLi(r,sureme);
                            if(ul){
                                ele.empty().append(ul);
                            }else{
                                ele.empty();
                            }
                        }else{
                            ele.empty();
                        }
                    });
                }else if(/^[^\d\w]+$/.test(value)){
                    //company
                    $.post(_host+'accountant/guest/searchByCom',{'com':value},function(r){
                        if(r){
                            var ul = buildLi(r,sureme);
                            if(ul){
                                ele.empty().append(ul);
                            }else{
                                ele.empty();
                            }
                        }else{
                            ele.empty();
                        }
                    });
                }else{
                    ele.empty();
                }
            }

            $(document).ready(function(){
                //点击菜单 更新导航
                var eles = $("#me-navigation").find("a"),
                    parent = $("#parent-nav"),
                    sub = $("#sub-nav");

                for(var i = 0,len = eles.length;i<len;i++){
                    if(eles[i].className == 'nav-submenu'){
                        (function(i){
                            var target = $(eles[i]);
                            target.bind('click',function(){
                                parent.text(target.find('span').text());
                                sub.text("");
                            });
                            var href = target.siblings('ul').find("a");
                            $(href).bind('click',function(){
                                sub.text(">"+$(this).text());
                            });
                        })(i);
                    }
                }
            });
        </script>
    </body>
</html>
